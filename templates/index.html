<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/earlyaccess/nicomoji.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=M+PLUS+Rounded+1c" rel="stylesheet">
  <title>POKE HON</title>
  <style>
    body {
      font-family: "M PLUS Rounded 1c";
      text-align: center;
      margin: 0;
      padding: 0;
      background-color: #a5d696;
      font-size: 20px;
      background-image: url("{{ url_for('static', filename='images/kabigon1.jpg') }}");
      background-size: cover;
    }

    .container {
      padding: 10px;
      background-color: rgb(251, 252, 204);
      border-radius: 40px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      min-width: 60%;
      max-width: 90%;
      margin: 10px auto;
      opacity: 0.7;
    }

    h1 {
      color: #333;
      font-family: "Nico Moji";
      font-size: 5rem;
      color: #617cb9;
      text-shadow: 1px 1px 2px rgb(0, 0, 0);
    }

    h1 rt {
      color: rgb(53, 40, 126);
    }

    form {
      margin: 20px auto;
      width: 70%;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    input[type="text"],
    select {
      width: calc(100% - 20px);
      /* 余白を調整 */
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 3px;
      margin-bottom: 10px;
      margin: 10px;
    }

    #text {
      width: 95%;
      margin: 10px auto;
    }

    button {
      background-color: #007bff;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      margin-bottom: 50px;
    }

    button:hover {
      background-color: #0056b3;
    }

    #pokemon-image {
      position: absolute;
      width: 300px;
      height: 300px;
    }

    ul li {
      list-style: none;
    }

    input,
    .result {
      margin: 20px auto;
    }

    .balloon {
      position: relative;
      top: 345px;
      right: -62%;
      margin: 2em 0 2em 40px;
      padding: 15px;
      background: #fff0c6;
      border-radius: 30px;
      width: 140px;
      z-index: 1;
    }

    .balloon:before {
      content: "";
      position: absolute;
      top: 98px;
      left: -36px;
      width: 13px;
      height: 12px;
      bottom: 0;
      background: #fff0c6;
      border-radius: 50%;
    }

    .balloon:after {
      content: "";
      position: absolute;
      top: 73px;
      left: -23px;
      width: 20px;
      height: 18px;
      bottom: 3px;
      background: #fff0c6;
      border-radius: 50%;
    }

    .balloon p {
      margin: 0;
      padding: 0;
    }

    .balloon2 {
      position: relative;
      top: 772px;
      right: -20%;
      margin: 2em 0 2em 40px;
      padding: 15px;
      background: #fff0c6;
      border-radius: 30px;
      width: 140px;
      display: none;
      z-index: 1;
    }

    .balloon2:before {
      content: "";
      position: absolute;
      top: 20%;
      left: 110%;
      width: 13px;
      height: 12px;
      bottom: 0;
      background: #fff0c6;
      border-radius: 50%;
    }

    .balloon2:after {
      content: "";
      position: absolute;
      top: 50%;
      left: 100%;
      transform: translateY(-50%);
      width: 20px;
      height: 18px;
      bottom: 3px;
      background: #fff0c6;
      border-radius: 50%;
    }

    .balloon2 p {
      margin: 0;
      padding: 0;
    }

    @media screen and (min-width: 1000px) {
      .wrapper {
        display: flex;
      }
    }

    @media screen and (max-width: 800px) {
      .container {
        width: 80%;
      }

      h1 {
        font-size: 160%;
      }

      input[type="text"],
      select {
        width: 100%;
      }

      #pokemon-image {
        width: 180px;
        height: 180px;
      }

      .balloon,
      .balloon2 {
        display: none;
      }
    }
  </style>
</head>

<body>
  <img id="pokemon-image" src="{{ pokemon_data['sprites']['front_default'] }}" alt="Pokemon Image">
  <div class="balloon" id="balloon" style="display: block;">
    <p><ruby>翻訳<rt>ほんやく</rt></ruby>したい<ruby>言葉<rt>ことば</rt></ruby>を<ruby>入力<rt>にゅうりょく</rt></ruby>してね</p>
  </div>

  <div class="balloon2" id="success-balloon2" style="display: none;">
    <p><ruby>翻訳成功<rt>ほんやくせいこう</rt></ruby>!</p>
  </div>

  <div class="container">
    <h1>テキスト<ruby>
        <rb>翻訳</rb>
        <rt>ほんやく</rt>
      </ruby>アプリ</h1>

    <form action="/translate" method="post">
      <label for="text">テキストまたは<ruby>音声<rt>おんせい</rt></ruby>を<ruby>入力<rt>にゅうりょく</rt></ruby>してください:</label>

      <input type="text" id="text" name="text" required>
      <button id="start-listening"><ruby>音声入力<rt>おんせいにゅうりょく</rt></ruby></button>
      <label for="target_lang"><ruby>翻訳言語<rt>ほんやくげんご</rt></ruby>を<ruby>選択<rt>せんたく</rt></ruby>してください:</label>
      <select id="target_lang" name="target_lang" required>
        <option value="en">英語</option>
        <option value="ja">日本語</option>
        <option value="fr">フランス語</option>
        <option value="de">ドイツ語</option>
        <option value="es">スペイン語</option>
        <option value="nl">オランダ語</option>
        <option value="sv">スウェーデン語</option>
      </select>

      <button type="submit"><ruby>翻訳<rt>ほんやく</rt></ruby>する</button>
    </form>
    {% if text %}
    <div>
      <h2>入力されたテキスト:</h2>
      <p>{{ text }}</p>
    </div>
    <h2><ruby>翻訳結果<rt>ほんやくけっか</rt></ruby>:</h2>
    <p>{{ translated_text }}</p>
    <button id="play-translated-text"><ruby>翻訳<rt>ほんやく</rt></ruby>テキストを<ruby>再生<rt>さいせい</rt></ruby></button>
    {% endif %}

    <h2><ruby>翻訳履歴<rt>ほんやくりれき</rt></ruby>:</h2>
    <ul>
      {% for text, translated_text in translation_history %}
      <li>{{ text }} -> {{ translated_text }}</li>
      {% endfor %}
    </ul>
  </div>
  </div>

  <!-- JavaScript -->

    <script>
    // 音声認識ボタン要素を取得
    const startListeningButton = document.getElementById("start-listening");

    // SpeechRecognitionの初期化
    const recognition = new webkitSpeechRecognition();
    // recognition.continuous = false; // 連続音声認識を使用しない場合はコメントアウト
    recognition.interimResults = false; // 途中結果を使用しない

    // 音声認識の結果が得られたときの処理
    recognition.onresult = function (event) {
      const result = event.results[0][0].transcript;
      textInput.value = result;
    };

    // 音声認識エラーが発生したときの処理
    recognition.onerror = function (event) {
      console.error('音声認識エラー:', event.error);
    };

    // 音声認識開始ボタンがクリックされたときの処理
    startListeningButton.addEventListener("click", function () {
      recognition.start();
    });

    // テキスト入力要素を取得
    const textInput = document.getElementById("text");

    // 翻訳テキストを読み上げるJavaScript
    document.getElementById("play-translated-text").addEventListener("click", function () {
      var translatedText = "{{ translated_text|default('') }}";
      var synth = window.speechSynthesis;
      var utterance = new SpeechSynthesisUtterance(translatedText);
      synth.speak(utterance);
    });

    // 画像の移動に関する変数の初期化
    let x = window.innerWidth / 2 - 50;
    let y = window.innerHeight / 2 - 50;
    let moveSpeed = 3;
    let moveXDirection = 1;
    let moveYDirection = 1;
    const imageElement = document.getElementById("pokemon-image");

    // 画像を移動する関数
    function moveImage() {
      x += moveSpeed * moveXDirection;
      y += moveSpeed * moveYDirection;

      // 画像がウィンドウの端に達した場合の処理
      if (x <= 0 || x >= window.innerWidth - imageElement.width) {
        moveXDirection *= -1;
      }
      if (y <= 0 || y >= window.innerHeight - imageElement.height) {
        moveYDirection *= -1;
      }

      // 画像の位置を更新
      imageElement.style.left = x + "px";
      imageElement.style.top = y + "px";

      // アニメーションフレームをリクエストして再帰的に呼び出す
      requestAnimationFrame(moveImage);
    }

    // 画像移動関数の呼び出し
    moveImage();

    // 翻訳テキストの取得
    const translatedText = "{{ translated_text|default('') }}";

    // バルーン要素の取得
    const balloon = document.getElementById("balloon");
    const balloon2 = document.getElementById("success-balloon2");

    // 翻訳テキストがある場合の表示制御
    if (translatedText.trim() !== "") {
      balloon.style.display = "none";
      balloon2.style.display = "block";
    } else {
      balloon.style.display = "block";
      balloon2.style.display = "none";
    }
  </script>

</body>

</html>